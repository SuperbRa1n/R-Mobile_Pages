import{s as e,j as a,k as t,E as s,q as l,c as o,w as u,b as i,o as r,a as n,t as m,v as c,F as h,z as d,x as f,h as p,y as g,A as w,J as y,G as _}from"./index-CQZovXBN.js";import{u as C,_ as S,a as k}from"./uni-search-bar.DvUzZgGD.js";import{r as b}from"./uni-app.es.Bvjx594B.js";import{_ as D}from"./custom-waterfalls-flow.D9mpW88x.js";import{_ as F,i as B,j as I}from"./api.BbjEcOtK.js";import{d as T,_ as M,a as j}from"./robot.C68vtuzy.js";import"./runtime.CoBkiQaE.js";const W=F({components:{duiFloatBall:T,customWaterfallsFlow:D,uniSearchBar:C,iDropDownList:S},data:()=>({selectedItems:{type:"全部类型",publish_method:"全部发行方式"},museumType:{},museumList:[],page:1,total:0,searchQuery:"",showFloatBalls:!1,floatBallPosition:{left:"100%",top:"60%"}}),methods:{async loadMuseumData(){if(0===Object.keys(this.museumType).length&&(e({title:"加载中...",mask:!0}),this.museumType=await B(),this.museumType.type.unshift("全部类型"),this.museumType.publish_method.unshift("全部发行方式")),this.museumList.length>=this.total&&0!==this.total)return;const{type:t,publish_method:s}=this.selectedItems,l=await I(this.searchQuery,"全部类型"===t?[]:[t],"全部发行方式"===s?[]:[s],this.page);this.total=l.total,this.museumList=this.museumList.concat(l.data),this.page++,a()},handleSelectChange(e,a){const t=this.museumType[a][e.detail.value];this.selectedItems[a]=t,this.museumList=[],this.page=1,this.loadMuseumData(),this.refreshWaterfall()},formatDate(e){if(!e)return"";let a;if("string"==typeof e)if(e.includes("T")||e.includes("Z"))a=new Date(e);else{const t=e.replace(/-/g,"/");a=new Date(t)}else a=new Date(e);if(isNaN(a.getTime()))return console.warn("Invalid date:",e),e||"";return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},goToMuseumDetail(e){t({url:`/pages/museumDetail/museumDetail?id=${e}`})},openSearchPage(){t({url:"/pages/search/search"})},toggleFloatBalls(){this.showFloatBalls=!this.showFloatBalls},handleSlotClick(){this.openSearchPage(),this.toggleFloatBalls()},handleSearchClick(){this.openSearchPage(),this.toggleFloatBalls()},handleAIClick(){this.openAIPage(),this.toggleFloatBalls()},openAIPage(){window.open("https://yuanqi.tencent.com/agent/odkRuwhLRg5E")},handleContact(e){console.log("客服会话开始",e)},handleMuseumClick(e,a){this.goToMuseumDetail(e.id)},refreshWaterfall(){this.$refs.museumWaterfall&&this.$refs.museumWaterfall.refresh()},async performSearch(){this.searchQuery?(this.museumList=[],this.page=1,await this.loadMuseumData(),this.refreshWaterfall()):s({title:"请输入搜索内容",icon:"none"})},async clearSearch(){this.searchQuery="",this.museumList=[],this.page=1,await this.loadMuseumData(),this.refreshWaterfall()}},onShareAppMessage:e=>("button"===e.from&&console.log(e.target),{title:"亲爱的瑞秋",path:"/pages/museum/museum"}),onShareTimeline:()=>({title:"亲爱的瑞秋"}),async mounted(){await this.loadMuseumData()}},[["render",function(e,a,t,s,C,F){const B=w,I=b(l("i-drop-down-list"),S),T=i,W=_,x=b(l("uni-search-bar"),k),L=b(l("custom-waterfalls-flow"),D),v=y;return r(),o(T,{class:"container"},{default:u((()=>[n(T,{class:"topNav"},{default:u((()=>[n(T,{class:"dropdowns"},{default:u((()=>[(r(!0),m(h,null,c(C.museumType,((e,a)=>(r(),o(W,{key:a,mode:"selector",range:e,onChange:e=>F.handleSelectChange(e,a)},{default:u((()=>[n(T,{class:"dropdown"},{default:u((()=>[n(B,{style:{color:"#95C9EF","font-size":"20rpx"}},{default:u((()=>[f(g(C.selectedItems[a]),1)])),_:2},1024),n(I,{theme:"outline",size:"25rpx",fill:"#95C9EF"})])),_:2},1024)])),_:2},1032,["range","onChange"])))),128))])),_:1})])),_:1}),n(T,{class:"searchBarWrapper"},{default:u((()=>[n(x,{modelValue:C.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=e=>C.searchQuery=e),placeholder:"搜索藏品名称/关键词等信息",onConfirm:F.performSearch,onSearch:F.performSearch,onClear:F.clearSearch,onCancel:F.clearSearch,radius:20,bgColor:"#fff",cancelButton:"none",style:{width:"96vw","box-shadow":"0 4rpx 12rpx rgba(0, 0, 0, 0.08)"}},null,8,["modelValue","onConfirm","onSearch","onClear","onCancel"])])),_:1}),n(T,{class:"h5-main-float-button",onClick:F.toggleFloatBalls},{default:u((()=>[d("img",{src:"https://tannin-1316822731.cos.ap-nanjing.myqcloud.com/%E5%85%A8%E9%83%A8_all-application.png",class:"h5-main-icon"})])),_:1},8,["onClick"]),C.showFloatBalls?(r(),o(T,{key:0,class:"h5-float-button h5-search-button",onClick:F.handleSearchClick},{default:u((()=>[d("img",{src:M,class:"buttonIcon"}),n(B,{class:"buttonText"},{default:u((()=>[f("搜索")])),_:1})])),_:1},8,["onClick"])):p("",!0),C.showFloatBalls?(r(),o(T,{key:1,class:"h5-float-button h5-ai-button",onClick:F.handleAIClick},{default:u((()=>[d("img",{src:j,class:"buttonIcon"}),n(B,{class:"buttonText"},{default:u((()=>[f("AI助手")])),_:1})])),_:1},8,["onClick"])):p("",!0),n(v,{class:"museum-waterfall-container","scroll-y":"true",onScrolltolower:F.loadMuseumData},{default:u((()=>[n(L,{ref:"museumWaterfall",value:C.museumList,column:2,addTime:"200",onWapperClick:F.handleMuseumClick,onImageClick:F.handleMuseumClick,imageKey:"cover_url",columnSpace:"0.5"},{default:u((e=>[n(T,{class:"museum-waterfall-item"},{default:u((()=>[n(T,{class:"museum-waterfall-info"},{default:u((()=>[n(T,{class:"museum-waterfall-title"},{default:u((()=>[f(g(e.name),1)])),_:2},1024),n(T,{class:"museum-waterfall-meta"},{default:u((()=>[n(T,{class:"museum-waterfall-time"},{default:u((()=>[f(g(F.formatDate(e.publish_date)),1)])),_:2},1024),n(T,{class:"museum-waterfall-type"},{default:u((()=>[f(g(e.type)+"/"+g(e.publish_method),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:1},8,["value","onWapperClick","onImageClick"])])),_:1},8,["onScrolltolower"])])),_:1})}],["__scopeId","data-v-f6aeebf6"]]);export{W as default};
