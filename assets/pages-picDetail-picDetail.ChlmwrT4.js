import{s as i,j as a,C as e,D as t,E as l,q as s,t as c,c as n,w as r,h as o,F as p,b as d,o as u,a as m,x as D,y as h,z as g,A as f}from"./index-CQZovXBN.js";import{_ as v}from"./custom-waterfalls-flow.D9mpW88x.js";import{r as _}from"./uni-app.es.Bvjx594B.js";import{_ as I,d as y,e as w}from"./api.BbjEcOtK.js";const C=I({components:{customWaterfallsFlow:v},data:()=>({id:"",picDetail:{},totalImages:0,loadedImages:0,displayImages:[]}),methods:{formatDate(i){if(!i)return"";let a;if("string"==typeof i)if(i.includes("T")||i.includes("Z"))a=new Date(i);else{const e=i.replace(/-/g,"/");a=new Date(e)}else a=new Date(i);if(isNaN(a.getTime()))return console.warn("Invalid date:",i),i||"";return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},async loadPicDetail(e){i({title:"加载中...",mask:!0}),this.picDetail=await y(e),this.picDetail&&this.picDetail.pics&&(this.totalImages=this.picDetail.pics.length,this.picDetail.urls.forEach((i=>{this.displayImages.push({image:i,index:this.picDetail.urls.indexOf(i)})})),a())},async handlePicClick(i,a){await this.previewImage(i.index)},async previewImage(i){try{const a=await w(this.picDetail.pics[i]);e({urls:[a],current:a,longPressActions:{itemList:["保存图片"],success:i=>{0===i.tapIndex&&t({filePath:a,success:()=>{l({title:"保存成功"})},fail:()=>{l({title:"保存失败",icon:"none"})}})}}})}catch(a){console.error("获取高清图片失败:",a),l({title:"图片加载失败",icon:"none"})}},onImageLoad(){this.loadedImages++,this.loadedImages>=this.totalImages&&a()}},onShareAppMessage(i){return console.log(this.picDetail.name.split("_")[1]?this.picDetail.name.split("_")[1]:this.picDetail.name),{title:"亲爱的瑞秋-"+(this.picDetail.name.split("_").length>1?this.picDetail.name.split("_")[1]:this.picDetail.name),path:"/pages/picDetail/picDetail?id="+this.id}},onShareTimeline(){return{title:"亲爱的瑞秋-"+(this.picDetail.name.split("_").length>1?this.picDetail.name.split("_")[1]:this.picDetail.name),query:"id="+this.id}},async onLoad(i){const{id:a}=i;this.id=a,await this.loadPicDetail(a)}},[["render",function(i,a,e,t,l,I){const y=d,w=f,C=_(s("custom-waterfalls-flow"),v);return u(),c(p,null,[l.picDetail?(u(),n(y,{key:0,class:"picDetailInfo"},{default:r((()=>{var i;return[m(y,{class:"picDetailTitle"},{default:r((()=>{var i,a,e,t,s;return[D(h((null==(a=null==(i=l.picDetail)?void 0:i.name)?void 0:a.includes("_"))?null==(t=null==(e=l.picDetail)?void 0:e.name)?void 0:t.split("_")[1]:null==(s=l.picDetail)?void 0:s.name),1)]})),_:1}),m(y,{class:"picDetailType"},{default:r((()=>{var i;return[D("类型："+h(null==(i=l.picDetail)?void 0:i.type),1)]})),_:1}),m(y,{class:"picDetailSize"},{default:r((()=>{var i;return[D("作者："+h(null==(i=l.picDetail)?void 0:i.author),1)]})),_:1}),m(y,{class:"picDetailDate"},{default:r((()=>{var i;return[D("日期："+h(I.formatDate(null==(i=l.picDetail)?void 0:i.date)),1)]})),_:1}),m(y,{class:"picDetailTags"},{default:r((()=>{var i,a;return[D("Tag："+h(null==(a=null==(i=l.picDetail)?void 0:i.tags)?void 0:a.join(", ")),1)]})),_:1}),m(y,{class:"picDetailNote"},{default:r((()=>{var i;return[D("备注："+h(null==(i=l.picDetail)?void 0:i.note),1)]})),_:1}),(null==(i=l.picDetail)?void 0:i.copyright)?(u(),n(y,{key:0,class:"CC"},{default:r((()=>{var i;return[m(w,{class:"picDetailCC"},{default:r((()=>[D("本相册的所有图片按以下协议提供 附加条款见备注")])),_:1}),g("br"),g("img",{class:"picDetailCCImg",src:`https://mirrors.creativecommons.org/presskit/buttons/88x31/png/${null==(i=l.picDetail)?void 0:i.copyright}.png`},null,8,["src"])]})),_:1})):o("",!0)]})),_:1})):o("",!0),l.picDetail?(u(),n(y,{key:1,class:"pic-waterfall-container"},{default:r((()=>[m(C,{value:l.displayImages,column:2,addTime:"200",onWapperClick:I.handlePicClick,onImageClick:I.handlePicClick,columnSpace:"0.5"},null,8,["value","onWapperClick","onImageClick"])])),_:1})):o("",!0)],64)}],["__scopeId","data-v-eb618c09"]]);export{C as default};
