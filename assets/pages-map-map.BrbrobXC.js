import{o as a,c as t,w as e,a as s,n as o,i as l,b as i,s as n,j as c,k as r,P as h,q as d,x as p,z as u,h as g,I as m,H as k,Q as f,A as w}from"./index-CQZovXBN.js";import{g as C,I as L}from"./runtime.CoBkiQaE.js";import{_,x as y}from"./api.BbjEcOtK.js";import{r as F}from"./uni-app.es.Bvjx594B.js";import{d as b,_ as B,a as j}from"./robot.C68vtuzy.js";const I=_(C("i-search",L("i-search",(a=>'<?xml version="1.0" encoding="UTF-8"?><svg width="'+a.sizeWithUnit+'" height="'+a.sizeWithUnit+'" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 38C30.3888 38 38 30.3888 38 21C38 11.6112 30.3888 4 21 4C11.6112 4 4 11.6112 4 21C4 30.3888 11.6112 38 21 38Z" fill="'+a.colors[1]+'" stroke="'+a.colors[0]+'" stroke-width="'+a.strokeWidth+'" stroke-linejoin="'+a.strokeLinejoin+'"/><path d="M26.657 14.3431C25.2093 12.8954 23.2093 12 21.0001 12C18.791 12 16.791 12.8954 15.3433 14.3431" stroke="'+a.colors[2]+'" stroke-width="'+a.strokeWidth+'" stroke-linecap="'+a.strokeLinecap+'" stroke-linejoin="'+a.strokeLinejoin+'"/><path d="M33.2216 33.2217L41.7069 41.707" stroke="'+a.colors[0]+'" stroke-width="'+a.strokeWidth+'" stroke-linecap="'+a.strokeLinecap+'" stroke-linejoin="'+a.strokeLinejoin+'"/></svg>'))),[["render",function(n,c,r,h,d,p){const u=l,g=i;return a(),t(g,{class:"a-icon-svg",style:o([n.boxStyle])},{default:e((()=>[s(u,{class:"a-icon-pack-image",src:n.url,mode:"aspectFit"},null,8,["src"])])),_:1},8,["style"])}],["__scopeId","data-v-362ffe6b"]]);const x=_({components:{duiFloatBall:b},data:()=>({scale:15,centerLng:116.397474,centerLat:39.994272,markers:[],searchQuery:"",showFloatBalls:!1,floatBallPosition:{left:"100%",top:"60%"}}),methods:{async loadMapData(a=""){n({title:"加载中...",mask:!0});const t=await y(a);this.places=t.data||[],this.markers=this.places.map(((a,t)=>({id:t,latitude:a.geo[1],longitude:a.geo[0],title:a.name,iconPath:"/static/icons/localred.png",width:24,height:36,callout:{content:a.name,color:a.color,fontSize:14,borderRadius:8,bgColor:"#fff",padding:4,display:"ALWAYS"}}))),this.places.length>0&&!this._userLocated&&(this.centerLng=this.places[0].geo[0],this.centerLat=this.places[0].geo[1]),c()},async performSearch(){await this.loadMapData(this.searchQuery)},async onMarkerTap(a){const t=a.detail.markerId,e=this.places[t];e&&e.id&&r({url:`/pages/mapDetail/mapDetail?id=${e.id}`})},openSearchPage(){r({url:"/pages/search/search"})},toggleFloatBalls(){this.showFloatBalls=!this.showFloatBalls},handleFloatBallClick(){this.showFloatBalls||this.toggleFloatBalls()},handleSearchClick(){this.openSearchPage(),this.toggleFloatBalls()},handleSlotClick(){this.openSearchPage()},handleAIClick(){this.openAIPage(),this.toggleFloatBalls()},openAIPage(){window.open("https://yuanqi.tencent.com/agent/odkRuwhLRg5E")},handleContact(a){console.log("客服会话开始",a)},goToDetail(a){r({url:`/pages/mapDetail/mapDetail?id=${a}`})},setUserLocation(a,t){this.centerLng=a,this.centerLat=t,this._userLocated=!0}},async mounted(){h({type:"gcj02",success:a=>{this.setUserLocation(a.longitude,a.latitude),console.log(a)},fail:a=>{this._userLocated=!1,console.log("获取失败",a)}}),await this.loadMapData()},onLoad(a){if(a.lat&&a.lng){const t=parseFloat(a.lat),e=parseFloat(a.lng);this.centerLat=t,this.centerLng=e,this.scale=18,this._userLocated=!0}}},[["render",function(o,l,n,c,r,h){const C=F(d("i-search"),I),L=m,_=k,y=i,b=f,x=w;return a(),t(y,{class:"content"},{default:e((()=>[s(y,{class:"searchBox"},{default:e((()=>[s(C,{theme:"outline",size:"24",fill:"#95C9EF"}),s(L,{class:"searchInput",type:"text",placeholder:"搜索地点/关键词",modelValue:r.searchQuery,"onUpdate:modelValue":l[0]||(l[0]=a=>r.searchQuery=a),onConfirm:h.performSearch},null,8,["modelValue","onConfirm"]),s(_,{class:"searchButtonOne",onClick:h.performSearch},{default:e((()=>[p("搜索")])),_:1},8,["onClick"])])),_:1}),s(b,{style:{width:"100vw",height:"100vh"},scale:r.scale,longitude:r.centerLng,latitude:r.centerLat,markers:r.markers,"show-compass":!0,"show-location":!0,"enable-3d":!0,rotate:!0,onMarkertap:h.onMarkerTap},null,8,["scale","longitude","latitude","markers","onMarkertap"]),s(y,{class:"h5-main-float-button",onClick:h.toggleFloatBalls},{default:e((()=>[u("img",{src:"https://tannin-1316822731.cos.ap-nanjing.myqcloud.com/%E5%85%A8%E9%83%A8_all-application.png",class:"h5-main-icon"})])),_:1},8,["onClick"]),r.showFloatBalls?(a(),t(y,{key:0,class:"h5-float-button h5-search-button",onClick:h.handleSearchClick},{default:e((()=>[u("img",{src:B,class:"buttonIcon"}),s(x,{class:"buttonText"},{default:e((()=>[p("搜索")])),_:1})])),_:1},8,["onClick"])):g("",!0),r.showFloatBalls?(a(),t(y,{key:1,class:"h5-float-button h5-ai-button",onClick:h.handleAIClick},{default:e((()=>[u("img",{src:j,class:"buttonIcon"}),s(x,{class:"buttonText"},{default:e((()=>[p("AI助手")])),_:1})])),_:1},8,["onClick"])):g("",!0)])),_:1})}],["__scopeId","data-v-b4f205ff"]]);export{x as default};
