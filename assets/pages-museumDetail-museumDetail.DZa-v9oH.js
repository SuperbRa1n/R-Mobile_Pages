import{s as e,j as a,C as t,q as s,t as i,c as l,w as m,h as u,F as n,b as o,o as d,a as r,x as c,y as h,v as p,S as f,i as D,B as g}from"./index-CQZovXBN.js";import{_ as I}from"./custom-waterfalls-flow.D9mpW88x.js";import{r as _}from"./uni-app.es.Bvjx594B.js";import{_ as v,k as w,e as k}from"./api.BbjEcOtK.js";const y=v({components:{customWaterfallsFlow:I},data:()=>({id:"",museumDetail:{},totalItems:0,loadedItems:0,displayItems:[]}),methods:{formatDate(e){if(!e)return"";let a;if("string"==typeof e)if(e.includes("T")||e.includes("Z"))a=new Date(e);else{const t=e.replace(/-/g,"/");a=new Date(t)}else a=new Date(e);if(isNaN(a.getTime()))return console.warn("Invalid date:",e),e||"";return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},async loadMuseumDetail(t){e({title:"加载中...",mask:!0}),this.museumDetail=await w(t),console.log(this.museumDetail),this.museumDetail&&this.museumDetail.items&&(this.totalItems=this.museumDetail.items.reduce(((e,a)=>e+a.images.length),0),this.museumDetail.items.forEach(((e,a)=>{this.displayItems.push({image:e.images&&e.images.length>0?e.images[0].url:"",itemIndex:a,name:e.name,provider:e.provider,dimension:e.dimension,note:e.note,images:e.images,hide:!0})})),a())},handleItemClick(e){this.previewImage(e.itemIndex,0)},handleImageClick(e){this.previewImage(e.itemIndex,0)},async previewImage(s,i){let l=[],m=await k(this.museumDetail.items[s].images[i].path);l.push(m),e({title:"加载中...",mask:!0}),a(),t({urls:l,current:i})},onImageLoad(){this.loadedItems++,this.loadedItems===this.totalItems&&a()}},onShareAppMessage(e){return console.log(this.museumDetail.name.split("_")[1]?this.museumDetail.name.split("_")[1]:this.museumDetail.name),{title:"亲爱的瑞秋-"+(this.museumDetail.name.split("_").length>1?this.museumDetail.name.split("_")[1]:this.museumDetail.name),path:"/pages/museumDetail/museumDetail?id="+this.id}},onShareTimeline(){return{title:"亲爱的瑞秋-"+(this.museumDetail.name.split("_").length>1?this.museumDetail.name.split("_")[1]:this.museumDetail.name),query:"id="+this.id}},async onLoad(e){const{id:a}=e;this.id=a,await this.loadMuseumDetail(a)}},[["render",function(e,a,t,v,w,k){var y,C;const x=o,T=D,S=g,j=f,F=_(s("custom-waterfalls-flow"),I);return d(),i(n,null,[w.museumDetail?(d(),l(x,{key:0,class:"museumDetailInfo"},{default:m((()=>[r(x,{class:"museumDetailTitle"},{default:m((()=>{var e;return[c(h(null==(e=w.museumDetail)?void 0:e.name),1)]})),_:1}),r(x,{class:"museumDetailInfoText"},{default:m((()=>{var e;return[c("类型："+h(null==(e=w.museumDetail)?void 0:e.type),1)]})),_:1}),r(x,{class:"museumDetailInfoText"},{default:m((()=>{var e;return[c("发行方式："+h(null==(e=w.museumDetail)?void 0:e.publish_method),1)]})),_:1}),r(x,{class:"museumDetailInfoText"},{default:m((()=>{var e;return[c("发行日期："+h(k.formatDate(null==(e=w.museumDetail)?void 0:e.publish_date)),1)]})),_:1}),r(x,{class:"museumDetailInfoText"},{default:m((()=>{var e,a,t,s,i,l;return[c(" 尺寸信息：宽"+h(null==(a=null==(e=w.museumDetail)?void 0:e.dimension)?void 0:a.w)+"cm，长"+h(null==(s=null==(t=w.museumDetail)?void 0:t.dimension)?void 0:s.d)+"cm，高"+h(null==(l=null==(i=w.museumDetail)?void 0:i.dimension)?void 0:l.h)+"cm ",1)]})),_:1})])),_:1})):u("",!0),w.museumDetail?(d(),l(x,{key:1,class:"museum-waterfall-container"},{default:m((()=>[r(F,{ref:"museumWaterfall",value:w.displayItems,column:2,addTime:"200",onWapperClick:k.handleItemClick,onImageClick:k.handleImageClick,columnSpace:"0.5",seat:"1",hideImageKey:"hide"},{default:m((e=>[r(x,{class:"museum-waterfall-item"},{default:m((()=>[r(x,{class:"museumItemCard"},{default:m((()=>[r(x,{class:"itemHeader"},{default:m((()=>[r(x,{class:"itemName"},{default:m((()=>[c(h(e.name),1)])),_:2},1024),r(x,{class:"itemInfo"},{default:m((()=>[c("提供者："+h(e.provider),1)])),_:2},1024),r(x,{class:"itemInfo"},{default:m((()=>[c("尺寸："+h(e.dimension.w)+"cm × "+h(e.dimension.d)+"cm × "+h(e.dimension.h)+"cm",1)])),_:2},1024),r(x,{class:"itemInfo"},{default:m((()=>[c("备注："+h(e.note?e.note:"无"),1)])),_:2},1024)])),_:2},1024),r(j,{class:"imageSwiper",circular:"",autoplay:"","indicator-dots":""},{default:m((()=>[(d(!0),i(n,null,p(e.images,((a,t)=>(d(),l(S,{key:t,onClick:a=>k.previewImage(e.itemIndex,t)},{default:m((()=>[r(x,{class:"swiperImageWrapper"},{default:m((()=>[r(T,{src:a.url,class:"museumDetailImageBlur",mode:"aspectFill","aria-hidden":"true"},null,8,["src"]),r(T,{class:"museumDetailImage",src:a.url,mode:"aspectFit",alt:a.name,onLoad:k.onImageLoad},null,8,["src","alt","onLoad"])])),_:2},1024),r(x,{class:"imgCaption"},{default:m((()=>[c(h(a.name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:1},8,["value","onWapperClick","onImageClick"])])),_:1})):u("",!0),0===(null==(C=null==(y=w.museumDetail)?void 0:y.items)?void 0:C.length)?(d(),l(x,{key:2,class:"emptyText"},{default:m((()=>[c(" 暂无组件信息～ ")])),_:1})):u("",!0)],64)}],["__scopeId","data-v-fe9ec6c2"]]);export{y as default};
